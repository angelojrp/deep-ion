name: issue-welcome

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  post-commands:
    runs-on: ubuntu-latest
    steps:
      - name: Post available commands
        uses: actions/github-script@v7
        with:
          script: |
            const body = `## ğŸ‘‹ Bem-vindo ao pipeline da FÃ¡brica de Software AutÃ´noma!

            Esta issue serÃ¡ processada pelo pipeline de agentes. Abaixo estÃ£o os comandos disponÃ­veis para cada etapa.

            ---

            ### ğŸš¦ Gate 1 â€” AprovaÃ§Ã£o de Descoberta (DOM-01 â†’ DOM-02)
            | Comando | DescriÃ§Ã£o |
            |---------|-----------|
            | \`/gate1-approve\` | Aprova a classificaÃ§Ã£o e inicia a anÃ¡lise de requisitos (DOM-02) |
            | \`/gate1-reject <motivo>\` | Rejeita a demanda com justificativa |

            ### ğŸ“‹ Checkpoint A â€” RevisÃ£o do BAR (SKILL-REQ-01)
            | Comando | DescriÃ§Ã£o |
            |---------|-----------|
            | \`/ba-approve\` | Aprova o Business Analysis Record (BAR) e avanÃ§a para modelagem de Use Cases |
            | \`/ba-reject <motivo>\` | Rejeita o BAR com justificativa |
            | \`/ba-revise <campo>=<valor>\` | Solicita revisÃ£o de um campo especÃ­fico do BAR |

            ### ğŸ” Gate 2 â€” AprovaÃ§Ã£o de Requisitos (DOM-05a â†’ DOM-03)
            | Comando | DescriÃ§Ã£o |
            |---------|-----------|
            | \`/gate2-approve\` | Aprova os artefatos de requisitos e inicia a arquitetura (DOM-03) |
            | \`/gate2-reject <motivo>\` | Rejeita os artefatos com justificativa |

            ### ğŸ›ï¸ Gate 3 â€” AprovaÃ§Ã£o de Arquitetura (DOM-03 â†’ DOM-04)
            | Comando | DescriÃ§Ã£o |
            |---------|-----------|
            | \`/gate3-approve\` | Aprova a arquitetura e inicia o desenvolvimento (DOM-04) |
            | \`/gate3-reject <motivo>\` | Rejeita a arquitetura com justificativa |

            ### âœ… Gate 4 â€” AprovaÃ§Ã£o TÃ©cnica do PR (DOM-05b â†’ merge)
            | Comando | DescriÃ§Ã£o |
            |---------|-----------|
            | \`/gate4-approve\` | Aprova o PR apÃ³s QA tÃ©cnico e libera para homologaÃ§Ã£o |
            | \`/gate4-reject <motivo>\` | Rejeita o PR com justificativa |

            ### ğŸ” ReclassificaÃ§Ã£o de Impacto
            | Comando | DescriÃ§Ã£o |
            |---------|-----------|
            | \`/reclassify-T0\` | Reclassifica a demanda como T0 â€” Trivial (autÃ´nomo) |
            | \`/reclassify-T1\` | Reclassifica a demanda como T1 â€” Semi-autÃ´nomo |
            | \`/reclassify-T2\` | Reclassifica a demanda como T2 â€” Multi-gate |
            | \`/reclassify-T3\` | Reclassifica a demanda como T3 â€” Totalmente assistido |

            ---

            > ğŸ’¡ **Dica:** Apenas membros autorizados podem executar comandos de gate. A sequÃªncia correta do pipeline Ã©: Gate 1 â†’ Checkpoint A â†’ Gate 2 â†’ Gate 3 â†’ Gate 4.`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue.number,
              body
            });
